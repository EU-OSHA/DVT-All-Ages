define(function(require){"use strict";function nextId(){return sequence++}function ZylkBarChartDirective(dataService,plotsProvider,exportService,$log,maximize,$cookies){var _template='<div class="col-md-12 dvt-chart zylk-bar-chart"><div class="row"><div class="header col-md-12 nopadding"><div class="col-xs-11 col-sm-10 col-md-9 nopadding text-left wrapper-title-graphic"><h3 ng-if="(!!title && !isMaximized) || (isMaximized && !longTitle)" class="title" data-ng-bind-html="title"></h3><h3 ng-if="!!isMaximized && !!longTitle" class="title" data-ng-bind-html="longTitle"></h3></div><div class="col-md-2 col-lg-3 nopadding pull-right wrapper-contextual-menu"><div data-ng-if="haveEnlarge" class="pull-right contextual-menu enlarge-button cursor-pointer"><button data-ng-click="open(items[0].action)" title="Compare with other groups">Compare groups</button></div><div class="pull-right contextual-menu cursor-pointer maximizeImage" data-ng-if="!haveEnlarge">';return _template+='<div><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true"><i class="three-points-vertical" title="Export"></i></button><ul class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenu1"><li data-ng-repeat="item in items"><a data-ng-click="open(item.action)" data-ng-if="item.text!=\'Compare\'" role="button" data-ng-bind="item.text"></a></li></ul></div>',_template+="</div>",_template+='<div class="pull-right contextual-menu cursor-pointer maximizeImage" data-ng-if="!isMaximized && haveEnlarge"><div><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true"><i class="three-points-vertical" title="Export"></i></button><ul class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenu1"><li data-ng-repeat="item in items"><a data-ng-click="open(item.action)" data-ng-if="item.text!=\'Compare\'" role="button" data-ng-bind="item.text"></a></li></ul></div></div>',_template+='<div data-ng-if="isMaximized && isEnlarged==undefined && isZoom" class="pull-right contextual-menu">',navigator.userAgent.match("iPad")||(_template+='<div class="dropdown" ng-if="!isEnlarge==true"><a data-ng-click="open(\'exportImageLink\')" role="button"><i class="fa fa-picture-o" aria-hidden="true"></i> Export as Image</a></div>'),_template+='</div></div></div><div class="backGraps"><div data-ng-attr-id="{{ id }}"></div></div><div class="legend-info" ng-if="isMaximized && legendClickMode" data-ng-bind="legendDesc.legendDescriptionTitle"></div><div class="logoGraphics-wrapper"><img alt="European Agency for Safety and Health at Work" src="/pentaho/plugin/pentaho-cdf-dd/api/resources/system/all-ages/static/custom/img/EU-OSHA-trans-en.png" class="logoGraphics"></div><div ng-if="!!functionalLegend" class="functionalLegend" data-ng-bind-html="functionalLegend"></div></div>',{restrict:"E",require:["^zylkDashboard"],replace:!0,scope:{listenTo:"=",params:"=",postFetch:"=",postExecution:"=",clickAction:"=",labelTop:"=",baseAxisLabelText:"=",baseAxisLabelLongText:"=",baseAxisLabelVisible:"=",labelVisible:"=",labelTextAlign:"=",valuesVisible:"=",colors:"=",calculations:"=",plots:"=",readers:"=",dimensions:"=",visualRoles:"=",barFillStyle:"=",color2AxisColors:"=",contextuals:"=?",maxLabelTop:"=",enlargeAction:"="},template:_template,link:function(scope,element,attributes,controllers){attributes.id.split("_").length>1&&(attributes.id=attributes.id.split("_")[1]),scope.id="zylk_bar_chart_"+nextId();var dashboard=controllers[0];scope.divClass=attributes.cssClass||"col-xs-12 col-sm-6 col-md-3 col-lg-2",scope.enlargeAction&&(scope.haveEnlarge="true"),scope.legendDesc=legendDescription,scope.isMaximized=!!attributes.isMaximized,scope.isZoom=!!attributes.isZoom,scope.longTitle=attributes.longTitle,scope.isEnlarge=attributes.isEnlarged,"toggleVisible"==attributes.legendClickMode&&(scope.legendClickMode=!0);var definition={type:"cccBarChart",name:scope.id,executeAtStart:!0,priority:attributes.priority||5,htmlObject:scope.id,listeners:[],parameters:[],chartDefinition:{dataAccessId:attributes.query||null,path:attributes.cda||"all-ages/dashboards/datapilot.cda",title:attributes.title||"",width:attributes.width||300,height:attributes.height||250,orientation:attributes.orientation||"vertical",crosstabMode:!1,stacked:1==attributes.stacked||!1,axisLabel_font:attributes.axisLabelFont||'normal 12px "Open Sans"',axisTitleLabel_font:attributes.axisTitleLabelFont||'normal 12px "Open Sans" gray',axisTitleLabel_textStyle:"gray",clickable:!0,clickAction:function(dataset){},colorRole:"category",colors:[],colorMap:{},color2AxisTransform:function(c){return c.brighter(0)},animate:attributes.animate||!1,selectable:attributes.selectable||!1,hoverable:attributes.hoverable||!0,tooltipClassName:"light",tooltipOpacity:.8,orthoAxisVisible:!0,ortho2AxisVisible:!0,baseAxisVisible:!0,plotFrameVisible:!1,overflowMarkersVisible:!1,underflowMarkersVisible:!1,plotBg_fillStyle:plotsProvider.getPlotBgColor(),baseAxisGrid:attributes.baseAxisGrid||!1,orthoAxisGrid:attributes.orthoAxisGrid||!0,axisGrid_strokeStyle:"white",axisGrid_lineWidth:2,axisBandSizeRatio:.6,valuesVisible:!1,valuesMask:attributes.valuesMask||"{series}",valuesFont:attributes.valuesFont||'emphasis 10px "Open Sans"',valuesOptimizeLegibility:!0,valuesNormalized:!1,valuesFormat:scope.valuesFormat,label_top:scope.labelTop,legend:"true"===attributes.legend||!1,legendClickMode:attributes.legendClickMode||"toggleVisible",legendFont:attributes.legendFont||'normal 12px "Open Sans"',legendPosition:attributes.legendPos||"bottom",legendLabel_visible:!0,legendDot_strokeStyle:attributes.legendDotStrokeStyle,legendDot_shape:"square",baseAxisLabel_text:scope.isMaximized?scope.baseAxisLabelLongText:scope.baseAxisLabelText,baseAxisLabel_visible:scope.baseAxisLabelVisible,baseAxisLabel_textBaseline:attributes.baseAxisLabelTextBaseline||"top",baseAxisLabel_font:attributes.baseAxisLabelFont||'normal 12px "Open Sans"',baseAxisOverlappedLabelsMode:"leave",multiChartRole:attributes.multiChart,label_visible:scope.labelVisible,label_textAlign:scope.labelTextAlign||"center",tooltipGravity:"sw",tooltipFormat:scope.tooltipFormat,baseAxisTooltipEnabled:!1}};if(scope.baseAxisLabelText&&(definition.chartDefinition.baseAxisLabel_text=scope.baseAxisLabelText),scope.baseAxisLabelVisible&&(definition.chartDefinition.baseAxisLabel_visible=scope.baseAxisLabelVisible),scope.readers&&(definition.chartDefinition.readers=scope.readers),scope.dimensions&&(definition.chartDefinition.dimensions=scope.dimensions),scope.calculations&&(definition.chartDefinition.calculations=scope.calculations),scope.plots&&(definition.chartDefinition.plots=scope.plots),scope.params&&(definition.parameters=scope.params),scope.listenTo)for(var listen in scope.listenTo)definition.listeners[listen]=scope.listenTo[listen];scope.clickAction&&(definition.chartDefinition.clickAction=scope.clickAction),scope.colors&&(definition.chartDefinition.colors=scope.colors),scope.color2AxisColors&&(definition.chartDefinition.color2AxisColors=scope.color2AxisColors),"vertical"==definition.chartDefinition.orientation?definition.chartDefinition.baseAxisLabel_textAlign=attributes.baseAxisLabelTextAlign||"center":"horizontal"==definition.chartDefinition.orientation&&(definition.chartDefinition.baseAxisLabel_textAlign=attributes.baseAxisLabelTextAlign||"right"),attributes.angle&&(definition.chartDefinition.baseAxisLabel_textAngle=1==attributes.angle?-Math.PI/3:-Math.PI/6.5,definition.chartDefinition.baseAxisLabel_textAlign="right",definition.chartDefinition.baseAxisLabel_textBaseline="top",attributes.angle>1&&(definition.chartDefinition.margins=scope.isMaximized?"1 1 -5 1":"1 1 -30 1",definition.chartDefinition.paddings=scope.isMaximized?"1 1 0 -27":"1 1 0 -25")),attributes.margins?definition.chartDefinition.margins=attributes.margins:definition.chartDefinition.margins="0",attributes.paddings?definition.chartDefinition.paddings=attributes.paddings:definition.chartDefinition.paddings="7 5 0 10",scope.postFetch&&(definition.postFetch=scope.postFetch);var postExec_=scope.postExecution;if(definition.postExecution=function(){postExec_&&postExec_();var fullwitdh=this.placeholder().width();this.chart.options.width=fullwitdh,this.chart.render(!0,!0,!1)},scope.dimensions&&(definition.chartDefinition.dimensions=scope.dimensions),scope.visualRoles&&(definition.chartDefinition.visualRoles=scope.visualRoles),attributes.pXLabels&&(definition.chartDefinition.xAxisLabel_visible=0!=attributes.pXLabels),attributes.pYLabels&&(definition.chartDefinition.yAxisLabel_visible=0!=attributes.pYLabels),attributes.colorRole)switch(attributes.colorRole){case"s":definition.chartDefinition.colorRole="series";break;case"c":definition.chartDefinition.colorRole="category";break;default:definition.chartDefinition.colorRole=attributes.colorRole}if(attributes.axisPercent&&"1"==attributes.axisPercent&&("vertical"==definition.chartDefinition.orientation?definition.chartDefinition.orthoAxisLabel_text=plotsProvider.setAxisXPercentFormat:definition.chartDefinition.orthoAxisLabel_text=plotsProvider.setAxisYPercentFormat),attributes.axisPercent2&&(definition.chartDefinition.ortho2AxisLabel_text=plotsProvider.setAxisYPercentFormat),scope.valuesVisible&&(definition.chartDefinition.valuesVisible=!!attributes.valuesVisible),attributes.legendDotFillStyle&&(definition.chartDefinition.legendDot_fillStyle=attributes.legendDotFillStyle,definition.chartDefinition.legendDot_strokeStyle=attributes.legendDotFillStyle),attributes.multiChart&&(definition.chartDefinition.multiChartRole=attributes.multiChart),attributes.orthoAxisVisible&&(definition.chartDefinition.orthoAxisVisible=0!=attributes.orthoAxisVisible),attributes.orthoAxisTitle&&(scope.isMaximized||attributes.orthoAxisTitleVisible)&&(definition.chartDefinition.orthoAxisTitle=attributes.orthoAxisTitle),attributes.axisFixedMin?definition.chartDefinition.orthoAxisFixedMin=attributes.axisFixedMin:definition.chartDefinition.orthoAxisFixedMin=0,attributes.axisFixedMax&&(definition.chartDefinition.orthoAxisFixedMax=attributes.axisFixedMax),attributes.axis2FixedMin&&(definition.chartDefinition.ortho2AxisFixedMin=attributes.axis2FixedMin),attributes.axis2FixedMax&&(definition.chartDefinition.ortho2AxisFixedMax=attributes.axis2FixedMax),attributes.step)definition.chartDefinition.orthoAxisTickUnit=attributes.step;else if(attributes.axisPercent){var diff=(definition.chartDefinition.orthoAxisFixedMax||100)-(definition.chartDefinition.orthoAxisFixedMin||0),stepVal=25;diff<20?stepVal=5:diff<50?stepVal=10:diff<75&&(stepVal=25),definition.chartDefinition.orthoAxisTickUnit=stepVal}attributes.ortho2AxisTitle&&(definition.chartDefinition.ortho2AxisTitle=attributes.ortho2AxisTitle),scope.barFillStyle&&(definition.chartDefinition.bar_fillStyle=scope.barFillStyle),scope.labelVisible&&(definition.chartDefinition.label_visible=scope.labelVisible),scope.labelTop&&(definition.chartDefinition.label_top=scope.labelTop);var chart;if(attributes.type)switch(attributes.type){case"dot":chart=new DotChartComponent(definition);break;case"lines":chart=new LineChartComponent(definition);break;case"pie":chart=new PieChartComponent(definition);break;default:chart=new BarChartComponent(definition)}else chart=new BarChartComponent(definition);if(dashboard.register(chart),!scope.contextuals||scope.contextuals.length>0){scope.contextuals||(scope.contextuals=[]),scope.contextuals.push(["Maximize","maximize"]);window.navigator.userAgent.indexOf("MSIE ")>0||navigator.userAgent.match(/Trident.*rv\:11\./)?[["Download raw data","exportData"]].forEach(function(item){scope.contextuals.push(item)}):[["Export as image","exportImage"],["Download raw data","exportData"]].forEach(configService.isMobile()?function(item){scope.contextuals.push(item)}:function(item){scope.contextuals.push(item)})}scope.showContextuals=scope.contextuals&&scope.contextuals.length>0||!1,scope.showContextuals&&(scope.items=[],scope.contextuals.forEach(function(item){scope.items.push({text:item[0],action:item[1]})}));scope.isMaximized||function(){definition.maxType=attributes.type,definition.id=attributes.id,attributes.id&&(definition.title=attributes.title),definition.chartType=attributes.type,definition.angle=attributes.angle,definition.promise=scope.promise,definition.country1=scope.country1,definition.country2=scope.country2,definition.valuesVisible=scope.valuesVisible,definition.maxLegendPos=attributes.maxLegendPos,definition.maxLabelTop=scope.maxLabelTop,definition.maxAxisPercent=attributes.axisPercent,definition.maxAxisPercent2=attributes.axisPercent2,definition.longTitle=attributes.longTitle,definition.baseAxisLabelLongText=scope.baseAxisLabelLongText,definition.orthoAxisTitle=attributes.orthoAxisTitle,attributes.maxFunctionalLegend&&(definition.maxFunctionalLegend=attributes.maxFunctionalLegend),void 0===attributes.disableMaxLegend?definition.legendClickMode="toggleVisible":definition.legendClickMode="none"}();var dvtModal=maximize.setModal(definition);if(scope.open=function(action){switch(action){case"enlarge":var scrollTop=$(window).scrollTop();$cookies.remove("scrollTop"),$cookies.put("scrollTop",scrollTop),scope.enlargeAction();break;case"retirementAge":case"HLYvsLE":break;case"maximize":maximize.doMaximize(dvtModal,definition,"maximize","MaximizeController",!1);break;case"exportImage":maximize.doMaximize(dvtModal,definition,"maximize","MaximizeController",!0);break;case"exportImageLink":exportService.exportImageAction(scope);break;case"exportData":exportService.exportDataAction(scope,dashboard)}},attributes.id){definition.chartDefinition.title=null;JSON.parse("["+attributes.id+"]").forEach(function(id,index,array){$log.debug("METADATA INDICATORS FOREACH----------------------------------\x3e"),$log.debug(id),dataService.getIndicatorMetadata(id).then(function(dataset){$log.debug(dataset),plotsProvider.showContextualData(dataset,definition,scope,attributes)})})}}}}var DotChartComponent=require("cdf/components/CccDotChartComponent"),LineChartComponent=require("cdf/components/CccLineChartComponent"),BarChartComponent=require("cdf/components/CccBarChartComponent"),PieChartComponent=require("cdf/components/CccPieChartComponent"),configService=require("horizontal/config/configService"),legendDescription=require("json!dvt/graphic/legendDescription"),sequence=1;return ZylkBarChartDirective.$inject=["dataService","plotsProvider","exportService","$log","maximize","$cookies"],ZylkBarChartDirective});