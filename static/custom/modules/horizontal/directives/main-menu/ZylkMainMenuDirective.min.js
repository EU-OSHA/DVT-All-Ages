define(function(require){"use strict";function ZylkMenuDirective($location,$log){return{restrict:"E",transclude:!0,replace:!0,scope:{},controller:["$rootScope","$scope","$state","configService","$http","$log","dataService",function($rootScope,$scope,$state,configService,$http,$log,dataService){var gtranslatorinfo=$(".gtranslator-info"),gtranslatorinfo=gtranslatorinfo.offset();$(document).click(function(e){$(e.target).closest("#gTranslate-modal").length||$(e.target).is($("#gTranslate-modal-link"))||$(e.target).is($("span.gtranslator-info"))||$("#gTranslate-modal").fadeOut("fast")}),$(".gtranslator-info").mouseover(function(){$("#gTranslate-modal").fadeIn("fast")}),$("#gTranslate-modal").mouseleave(function(){$("#gTranslate-modal").fadeOut("fast")}),configService.isMobile()&&angular.element(".a2a_button_print").remove();var breadCrumbStructure=require("json!dvt/directives/breadcrumb-items"),titleStructure=require("json!dvt/directives/title-items"),gtranslatorinfo=$(".gtranslator-info"),gtranslatorinfo=gtranslatorinfo.offset();$(document).click(function(e){$(e.target).closest("#gTranslate-modal").length||$(e.target).is($("#gTranslate-modal-link"))||$(e.target).is($("span.gtranslator-info"))||$("#gTranslate-modal").fadeOut("fast")}),$(".gtranslator-info").mouseover(function(){$("#gTranslate-modal").fadeIn("fast")}),$("#gTranslate-modal").mouseleave(function(){$("#gTranslate-modal").fadeOut("fast")});var path=configService.getHorizontalDirectiveDataPath("main-menu","menu");$http.get(path,{data:"",headers:{"Content-Type":"application/json"}}).success(function(menuStructure){$log.debug("menu structure fetched"),$scope.structure=menuStructure}),$scope.isCurrentStateMenu=function(path){var lPath=$location.path().split("/");$log.debug("isCurrentStateMenu and menu variable  |  path: "+path+"  |  lPath[1]: "+lPath[1]);var isCurrent=path===lPath[1]||""==lPath[1]&&"home"==path||"site-map"==lPath[1]&&"home"==path||"accessibility"==lPath[1]&&"home"==path||"privacy-policy"==lPath[1]&&"home"==path||"legal-notice"==lPath[1]&&"home"==path;return isCurrent&&$log.info("isCurrentStateMenu: "+path),isCurrent?"main-menu-selected":""},$scope.isCurrentSection=function(id){var lPath=$location.path().split("/");$log.debug("isCurrentSection and menu variable  |  "+id.replace(/\s+/g,"-")+"  |  "+breadCrumbStructure.sections[lPath[1]]),$scope.pathURLDVT=$location.absUrl(),$scope.pathURLDVTGoogle="https://plus.google.com/share?url="+$scope.pathURLDVT;var isCurrent=id.replace(/\s+/g,"-")===breadCrumbStructure.sections[lPath[1]];return isCurrent&&$log.info("isCurrentSection | section: '"+lPath[1]+"' under menu option: '"+id),isCurrent?"main-menu-selected":""},$scope.goToMethodology=function(){$state.go("methodology",{"#":$state.href($state.current.name,{},{absolute:!1}).split("/")[1]})},$scope.hideLinkMethodology=function(){if(null!==$state.href($state.current.name,{},{absolute:!1})){return-1!==["about-tool","legal-notice","accessibility","privacy-policy","site-map","newNonSenseState"].indexOf($state.href($state.current.name,{},{absolute:!1}).split("/")[1])?"hidden":""}return""},$scope.titleS=titleStructure,$scope.pathURLDVT=$location.absUrl(),$scope.pathURLDVTGoogle="https://plus.google.com/share?url="+$scope.pathURLDVT.replace("#","?_escaped_fragment_="),$rootScope.$on("$viewContentLoaded",function(event,viewConfig){$log.debug("------------------------------------------------------"),$log.info("'Loading $viewContentLoaded | current state: '"+$state.current.name+"'");var path=$location.path();$log.debug(path),$log.warn($state.current.name);var cadena="";if($scope.breadCrumb=breadCrumbStructure[$state.current.name],"home"==$state.current.name)$scope.isHome=!0,$scope.titleHeader=titleStructure["default-title"],$scope.title=titleStructure[$state.current.name];else{var pathURL=path.split("/");$scope.isHome=!1;var setBreadCrumbs=function(){$scope.breadCrumb=breadCrumbStructure[$state.current.name],$scope.title=titleStructure[$state.current.name],$scope.isHome=!1,$scope.anchorPath=$location.path().split("/")[1]},setTitleHeaderHTML=function(){if(-1!=$scope.breadCrumb.indexOf(" >> ")){for(var trozos=$scope.breadCrumb.split(" >> "),i=trozos.length-1;i>-1;i--)cadena+=trozos[i]+" - ";cadena=cadena.replace(/<[^>]*>?/g,"")}$scope.titleHeader=cadena+titleStructure["pages-title"]};dataService.structureCountries.then(function(dataset){var country=dataService.dataMapper(dataset).filter(function(item){return item.Id==pathURL[2]})[0];if("country-card"==$state.current.name)$scope.breadCrumb+="<span>"+country.Description+"</span>",$scope.title=country.Description,setTitleHeaderHTML();else if("country-comparison"==$state.current.name){var country2=dataService.dataMapper(dataset).filter(function(item){return item.Id==pathURL[3]})[0];$scope.breadCrumb+="<span>"+country.Description+" - "+country2.Description+"</span>",$scope.title=country.Description+" - "+country2.Description,setTitleHeaderHTML()}else setBreadCrumbs(),setTitleHeaderHTML()})}1==collapse.hasClass("indvt")&&(collapse.removeClass("indvt"),collapse.removeClass("in")),angular.element("title").html($scope.titleHeader)},$scope),$rootScope.$on("$stateNotFound",function(event,unfoundState,fromState,fromParams){$state.go("404",{}),console.warn("$stateChangeError: "),console.warn("unfoundState.to: "+unfoundState.to),console.warn("unfoundState.to: "+unfoundState.to),console.warn("unfoundState.options: "+unfoundState.options)}),$rootScope.$on("$stateChangeError",function(event,toState,toParams,fromState,fromParams,error){$state.go("404",{}),console.warn("$stateChangeError: "),console.warn("unfoundState.to: "+unfoundState.to),console.warn("unfoundState.to: "+unfoundState.to),console.warn("unfoundState.options: "+unfoundState.options)});var toggle=angular.element("button.navbar-toggle"),collapse=angular.element("#osha-menu-collapse");toggle.click(function(){1==collapse.hasClass("indvt")?(collapse.removeClass("indvt"),$log.debug("cerrado"),collapse.removeClass("in")):(collapse.addClass("indvt"),$log.debug("abierto"),collapse.removeClass("in"))}),angular.element("#osha-menu-collapse .dropdown-menu a").click(function(){collapse.removeClass("indvt"),collapse.removeClass("in")})}],templateUrl:configService.getHorizontalDirectiveTplPath("main-menu","menu")}}var configService=require("horizontal/config/configService");return ZylkMenuDirective.$inject=["$location","$log"],ZylkMenuDirective});