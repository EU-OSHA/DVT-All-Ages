define(function(require){"use strict";function controller($scope,$stateParams,$state,dataService,mapProvider,$log,configService,$document,$compile){function search($event){var policy=$("#policy-input").val();$log.debug("policy free text: "+policy),$log.debug("~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"),$log.debug($scope.searchParams.countries),dataService.getPLList(policy,$scope.searchParams.classifications,$scope.searchParams.countries).then(function(data){for(var i=0;i<data.data.resultset.length;i++){var valor=data.data.resultset[i][7];"OSH"==valor&&(data.data.resultset[i][7]=$scope.i18n.OSHText),"RTW"==valor&&(data.data.resultset[i][7]=$scope.i18n.RTWText)}$scope.policies=dataService.dataMapper(data),$scope.seeAllCountryPolicy&&($scope.seeAllCountryPolicy=!1),$scope.firstPage(),$log.debug("Search policies results"),$log.debug($scope.policies),$scope.paginationText=$scope.i18n.Displaying+" "+$scope.elementsStart+"-"+$scope.elementsEnd+" "+$scope.i18n.of+" "+$scope.policies.length,$state.transitionTo("policy",{},{notify:!1}),setTimeout(function(){seeMoreLimpiar()},200)}).catch(function(err){throw err}),$scope.currentPage=0}$scope.isCollapsed=!1,$scope.countries=[],$scope.classifications=[],$scope.policies=[],$scope.searchParams={countries:[],policies:[],classifications:[]},$scope.seeAllCountryPolicy=!1,$scope.currentPage=0,$scope.pageSize=10,$scope.data=[],$scope.elementsStart=1,$scope.elementsEnd=$scope.pageSize;var i18n=require("json!vertical/policy/i18n");$scope.i18n=i18n,$scope.promises={},$scope.promises.mapPromise=mapProvider.getEuropeShape(),$scope.dashboard={promises:$scope.promises};var seeMoreLimpiar=function(){angular.element(".policy-items").length>0&&(angular.element(".seemore").hide(),angular.element(".policy-items").each(function(x){angular.element(this).find("#long-description-"+x).removeClass("policy-description"),angular.element(this).find("#long-description-"+x).height()>90&&(angular.element(this).find("#long-description-"+x).addClass("policy-description"),angular.element(".seemore:eq("+x+")").show())}))};dataService.getAllCountries().then(function(data){$log.debug("getCountries"),$log.debug(data),data.data.resultset.map(function(elem){if("EU"!==elem[0]){var param=$stateParams.country?$stateParams.country:void 0;$scope.countries.push({key:elem[0],name:elem[1],param:param})}}),$stateParams.country&&""!==$stateParams.country&&(angular.element("#country-filter-"+$stateParams.country).checked=!0),$log.debug($scope.countries)}).catch(function(err){throw err}),dataService.getPLClassificationFilter().then(function(data){$log.debug("getPLClassificationFilter"),$log.debug(data);for(var classification in data.data.resultset){var valor=data.data.resultset[classification][0];"OSH"==valor&&(valor=$scope.i18n.OSHText),"RTW"==valor&&(valor=$scope.i18n.RTWText),$scope.classifications.push(valor)}}).catch(function(err){throw err}),$scope.toogleCountryClick=function($event,$index){$log.debug("addCountryClick CLICK");var element=angular.element($event.currentTarget);element.prop("checked")?$scope.searchParams.countries.push(element.attr("value")):$scope.searchParams.countries.splice($scope.searchParams.countries.indexOf(element.attr("value")),1),search($event)},$scope.toogleClassificationClick=function($event,$index){$log.debug("addclassificationClick CLICK");var element=angular.element($event.currentTarget);element.prop("checked")?(element.attr("value")==$scope.i18n.OSHText&&element.attr("value","OSH"),element.attr("value")==$scope.i18n.RTWText&&element.attr("value","RTW"),$scope.searchParams.classifications.push(element.attr("value"))):$scope.searchParams.classifications.splice($scope.searchParams.classifications.indexOf(element.attr("value")),1),search($event)},$scope.seeMore=function($event,$index){$log.debug("EXPAND CLICK");var id="long-description-"+$index,elemento=document.getElementById(id);angular.element(elemento).toggleClass("expanded");var element=angular.element(element);element.toggleClass("hide"),angular.element(".know-more.seemore:eq("+$index+")").toggleClass("up");configService.getImagesPath()},$scope.clickEnter=function($event){13===$event.which&&search($event)},$scope.search=search,$scope.clear=function($event){$scope.paginationHidden=!1,$scope.searchParams.classifications=[],$scope.searchParams.countries=[],$scope.searchParams.policies=[];var classifications=document.querySelectorAll("#filter1 > div.col-xs-12 > div.filters > input"),countries=document.querySelectorAll("#filter2 > div.col-xs-12 > div.filters > input");$log.debug(classifications),$log.debug(countries),[].forEach.call(classifications,function(classification,index){classification.checked=!1}),[].forEach.call(countries,function(country,index){country.checked=!1}),document.querySelector("#policy-input").value="",$scope.search(),$scope.currentPage=0,$state.transitionTo("policy",{},{notify:!1}),setTimeout(function(){seeMoreLimpiar()},200)},$scope.numberOfPages=function(){return Math.ceil($scope.policies.length/$scope.pageSize)},$scope.firstPage=function(){$scope.currentPage=0,$scope.elementsStart=1,$scope.elementsEnd=$scope.pageSize,$scope.elementsStart>9&&($scope.elementsStart=$scope.elementsStart+1),$scope.elementsEnd=$scope.elementsStart+($scope.pageSize-1),$scope.elementsEnd>$scope.policies.length&&($scope.elementsEnd=$scope.policies.length),$scope.paginationText=$scope.i18n.Displaying+" "+$scope.elementsStart+"-"+$scope.elementsEnd+" "+$scope.i18n.of+" "+$scope.policies.length,setTimeout(function(){seeMoreLimpiar()},200)},$scope.previousPage=function(){$scope.currentPage>0?($scope.currentPage--,$scope.currentPage>0?($scope.elementsStart=$scope.currentPage*$scope.pageSize,$scope.elementsEnd=$scope.elementsStart+$scope.pageSize):($scope.elementsStart=1,$scope.pageSize<=$scope.policies.length?$scope.elementsEnd=$scope.pageSize:$scope.elementsEnd=$scope.policies.length)):($scope.currentPage=0,$scope.elementsStart=1,$scope.elementsEnd=$scope.pageSize),$scope.elementsStart>9&&($scope.elementsStart=$scope.elementsStart+1),$scope.elementsEnd=$scope.elementsStart+($scope.pageSize-1),$scope.elementsEnd>$scope.policies.length&&($scope.elementsEnd=$scope.policies.length),$scope.paginationText=$scope.i18n.Displaying+" "+$scope.elementsStart+"-"+$scope.elementsEnd+" "+$scope.i18n.of+" "+$scope.policies.length,setTimeout(function(){seeMoreLimpiar()},200)},$scope.nextPage=function(){$scope.currentPage<$scope.policies.length/$scope.pageSize-1&&($scope.currentPage++,$scope.elementsStart=$scope.currentPage*$scope.pageSize,$scope.elementsStart+$scope.pageSize<=$scope.policies.length?$scope.elementsEnd=$scope.elementsStart+$scope.pageSize:$scope.elementsEnd=$scope.policies.length,$scope.elementsStart>9&&($scope.elementsStart=$scope.elementsStart+1),$scope.elementsEnd=$scope.elementsStart+($scope.pageSize-1),$scope.elementsEnd>$scope.policies.length&&($scope.elementsEnd=$scope.policies.length),$scope.paginationText=$scope.i18n.Displaying+" "+$scope.elementsStart+"-"+$scope.elementsEnd+" "+$scope.i18n.of+" "+$scope.policies.length,setTimeout(function(){seeMoreLimpiar()},200))},$scope.lastPage=function(){var resto=Math.floor($scope.policies.length/$scope.pageSize);$scope.currentPage=resto,$scope.currentPage==$scope.numberOfPages()&&($scope.currentPage=$scope.currentPage-1),$scope.elementsStart=$scope.currentPage*$scope.pageSize,$scope.elementsStart+$scope.pageSize<=$scope.policies.length?$scope.elementsEnd=$scope.elementsStart+$scope.pageSize:$scope.elementsEnd=$scope.policies.length,$scope.elementsStart>9&&($scope.elementsStart=$scope.elementsStart+1),$scope.elementsEnd=$scope.elementsStart+($scope.pageSize-1),$scope.elementsEnd>$scope.policies.length&&($scope.elementsEnd=$scope.policies.length),$scope.paginationText=$scope.i18n.Displaying+" "+$scope.elementsStart+"-"+$scope.elementsEnd+" "+$scope.i18n.of+" "+$scope.policies.length,setTimeout(function(){seeMoreLimpiar()},200)},$stateParams.policy&&""!==$stateParams.policy?($log.debug("searchsearchPolicyDetail ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"),function(policyId){$scope.paginationHidden=!0,dataService.getPolicyDetail(policyId).then(function(data){$log.debug("POLICY DETAIL"),$log.debug(data),$scope.policies=dataService.dataMapper(data),$scope.seeAllCountryPolicy=!0,setTimeout(function(){document.querySelector(".buttonmoreless"),document.querySelector(".hide"),document.querySelector("div.policy-description").className+=" expanded",angular.element(".know-more.seemore").addClass("up")},50),setTimeout(function(){seeMoreLimpiar()},200)}).catch(function(err){throw err})}($stateParams.policy)):$stateParams.country&&""!==$stateParams.country?($log.debug("searchSeeAllPoliciesCountry ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"),function(country){dataService.getPLList("","",[country]).then(function(data){$scope.policies=dataService.dataMapper(data),$log.debug($scope.policies),setTimeout(function(){seeMoreLimpiar()},200)}).catch(function(err){throw err})}($stateParams.country)):($log.debug("search ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"),search())}return controller.$inject=["$scope","$stateParams","$state","dataService","mapProvider","$log","configService","$document","$compile"],controller});